version: "3.9"

services:
  router:
    build:
      context: ./router
    platform: linux/amd64
    container_name: router
    privileged: true
    cap_add:
      - NET_ADMIN
    command: ./startup.sh
    networks:
      attacker_net:
        ipv4_address: 10.88.10.254
      home_net:
        ipv4_address: 10.88.20.254
      router_firewall_net:
        ipv4_address: 10.88.40.254
      victim_net:
        ipv4_address: 10.88.30.254

  firewall:
    build:
      context: ./firewall
    container_name: firewall
    privileged: true
    cap_add:
      - NET_ADMIN
    command: /opt/startup.sh
    ports:
      - "9090:9090"
    networks:
      router_firewall_net:
        ipv4_address: 10.88.40.10
      victim_net:
        ipv4_address: 10.88.30.253 

  victim:
    build:
      context: ./victim
    container_name: victim
    privileged: true
    cap_add:
      - NET_ADMIN
    ports:
      - "8000:80"
    command: /opt/startup.sh
    networks:
      victim_net:
        ipv4_address: 10.88.30.10

  iot1:
    build:
      context: ./iot
    container_name: iot1
    privileged: true
    cap_add:
      - NET_ADMIN
    command: /opt/startup.sh
    networks:
      home_net:
        ipv4_address: 10.88.20.10

  iot-bulb:
    build:
      context: ./iot-bulb
    container_name: iot-bulb
    privileged: true
    cap_add:
      - NET_ADMIN
    command: /opt/startup.sh
    networks:
      home_net:
        ipv4_address: 10.88.20.12

  iot-camera:
    build:
      context: ./iot-camera
    container_name: iot-camera
    privileged: true
    cap_add:
      - NET_ADMIN
    command: /opt/startup.sh
    ports:
      - "8081:8081"   
    networks:
      home_net:
        ipv4_address: 10.88.20.13

  iot-thermostat-web:
    build:
      context: ./iot-thermostat-web
    container_name: iot-thermostat-web
    privileged: true
    cap_add:
      - NET_ADMIN
    command: /opt/startup.sh
    ports:
      - "8082:8082"
    networks:
      home_net:
        ipv4_address: 10.88.20.14

  attacker:
    build:
      context: ./attacker
    container_name: attacker
    privileged: true
    cap_add:
      - NET_ADMIN
    command: /opt/startup.sh
    networks:
      attacker_net:
        ipv4_address: 10.88.10.10

  splunk:
    image: splunk/splunk:latest
    platform: linux/amd64
    container_name: splunk
    environment:
      - SPLUNK_START_ARGS=--accept-license
      - SPLUNK_GENERAL_TERMS=--accept-sgt-current-at-splunk-com
      - SPLUNK_PASSWORD=changeme123
    ports:
      - "8001:8000"
      - "8088:8088"
      - "9997:9997"
    networks:
      attacker_net:
        ipv4_address: 10.88.10.200
      home_net:
        ipv4_address: 10.88.20.200
      victim_net:
        ipv4_address: 10.88.30.200
    privileged: true
    restart: unless-stopped

networks:
  attacker_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.88.10.0/24

  home_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.88.20.0/24

  victim_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.88.30.0/24

  router_firewall_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.88.40.0/24